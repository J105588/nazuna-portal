# 管理画面最終版 (admin.html) - 完全ガイド

## 概要
このドキュメントは、なずなポータルの管理画面（admin.html）の最終版について説明します。
システム全体を分析し、すべての機能を統合した完全版です。

## システム構成

### 1. 認証システム
- **パスワードハッシュ化**: SHA-256によるパスワードハッシュ化
- **セッション管理**: SessionStorageを使用したセキュアなセッション管理
- **セッション検証**: ログイン状態の継続的な検証
- **ログアウト機能**: セッションクリアとログイン画面への切り替え

### 2. データベース統合
- **Supabase**: PostgreSQLデータベースとの統合
- **RLS (Row Level Security)**: データアクセス制御
- **API Client**: JSONP経由のGAS API統合

### 3. 主要機能モジュール

#### ダッシュボード
- 統計情報の表示
  - お知らせ数
  - アンケート数
  - 部活動数
  - フォーラム投稿数
- 最近の活動表示

#### お知らせ管理
- お知らせの一覧表示
- 新規作成・編集・削除
- カテゴリ分類
- 公開設定

#### アンケート管理
- アンケートの作成・編集
- 回答数統計
- 締切管理
- ステータス管理（下書き/実施中/終了）

#### 部活動管理
- 部活動情報の登録・編集
- カテゴリ別管理
- 部員数管理
- 活動日程管理

#### 生徒会情報管理
- メンバーの登録・編集
- 役職管理
- メンバー追加機能

#### 活動実績管理
- 実績の登録・編集・削除
- フィルター機能（年/月/カテゴリ）
- メンバー別管理
- 公開設定

#### 通知配信
- プッシュ通知の送信
- テンプレート選択
- 配信対象の選択（全ユーザー/Web/iOS/Android）
- リンク先URL設定
- 配信履歴の表示

#### フォーラム管理
- 投稿の管理
- ステータス管理（確認中/対応中/対応済み）
- 返信機能

### 4. UI/UX機能

#### レスポンシブデザイン
- モバイル対応（ハンバーガーメニュー）
- タブレット対応
- デスクトップ対応

#### アクセシビリティ
- ARIA属性の適切な使用
- キーボード操作対応
- フォーカス管理

#### アニメーション
- スムーズなページ遷移
- ローディング表示
- フェードイン/アウト効果

### 5. セキュリティ機能
- パスワードハッシュ化
- セッション管理
- XSS対策（escapeHtml関数）
- CSRF対策（GAS経由のAPI通信）

## ファイル構成

### HTML構造
```html
├── ヘッダー（ログイン画面）
├── 管理画面メイン
│   ├── ヘッダー（ナビゲーション）
│   ├── サイドバー（メニュー）
│   └── メインコンテンツ
│       ├── ダッシュボード
│       ├── お知らせ管理
│       ├── アンケート管理
│       ├── 部活動管理
│       ├── 生徒会情報
│       ├── 活動実績管理
│       ├── 通知配信
│       └── フォーラム管理
├── モーダル
└── フッター
```

### 依存ファイル
- `css/style.css` - 共通スタイル
- `css/admin.css` - 管理画面専用スタイル
- `js/config.js` - 設定ファイル
- `js/supabase-queries.js` - Supabaseクエリ
- `js/firebase-config.js` - Firebase設定
- `js/app.js` - アプリケーション共通ロジック
- `js/pwa-update.js` - PWA更新管理
- `js/admin.js` - 管理画面専用ロジック

## 改善点（最終版）

### 1. メタ情報の強化
- SEO対応のメタディスクリプション追加
- ファビコン設定
- テーマカラーの設定

### 2. 通知フォームの改善
- リンク先URL入力欄の追加
- 文字数制限の追加（maxlength）
- 配信対象の細分化（Web/iOS/Android）

### 3. フォーム検証
- HTML5バリデーション
- イベントハンドラーの適切な設定

### 4. アクセシビリティ向上
- 適切なID属性の設定
- ARIA属性の追加

## 使用方法

### 初期設定
1. Supabaseの設定
   - `js/config.js`にSupabase URLとAPI Keyを設定
   
2. Firebaseの設定
   - `js/firebase-config.js`にFirebase設定を追加
   
3. GAS APIの設定
   - `js/config.js`にGAS URLを設定

### ログイン
1. 管理画面にアクセス
2. メールアドレスとパスワードを入力
3. ログインボタンをクリック

### 機能の使用
- サイドバーのメニューから各機能にアクセス
- モーダルでデータの追加・編集
- テーブルでデータの一覧表示

## セキュリティに関する注意事項

1. **パスワード管理**
   - 強力なパスワードを使用
   - 定期的なパスワード変更
   - パスワードの共有禁止

2. **セッション管理**
   - ブラウザを閉じる前にログアウト
   - 共有PCでの使用禁止

3. **データバックアップ**
   - 定期的なデータベースバックアップ
   - 重要な設定の記録

## トラブルシューティング

### ログインできない場合
1. メールアドレスとパスワードを確認
2. ブラウザのキャッシュをクリア
3. Supabaseの接続を確認

### データが表示されない場合
1. SupabaseのRLSポリシーを確認
2. ネットワーク接続を確認
3. ブラウザのコンソールでエラーを確認

### 通知が送信できない場合
1. Firebase設定を確認
2. FCM トークンの登録状態を確認
3. ブラウザの通知権限を確認

## 今後の拡張予定

1. ユーザー管理機能
2. ログ機能
3. 詳細な権限管理
4. データエクスポート機能
5. バッチ処理機能

## バージョン情報
- バージョン: 1.0.0
- 最終更新: 2025年10月
- 開発者: 市川学園生徒会

## ライセンス
© 2025 市川学園生徒会 - All Rights Reserved

